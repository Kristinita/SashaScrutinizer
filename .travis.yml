# See configuration comments in “.travis.yml file of KristinitaPelican”:
# https://github.com/Kristinita/KristinitaPelican/blob/master/.travis.yml
git:
  depth: 1

# Run Travis CI build only  for specific branch:
# https://docs.travis-ci.com/user/customizing-the-build/#Safelisting-or-blocklisting-branches
branches:
  only:
  - SashaYAML

language: python

python: 3.6

install:
  - sudo apt-get install parallel
  - pip install -U pip
  - bash travis-install.sh
  - git clone https://github.com/ggreer/the_silver_searcher --depth=1
  - cd the_silver_searcher
  - sudo apt-get install -y automake pkg-config libpcre3-dev zlib1g-dev liblzma-dev
  - bash ./build.sh
  - sudo make install
  - cd $TRAVIS_BUILD_DIR

before_script:
  - sudo chmod -R 777 .

script:

  - flake8 .
  - yamllint -s PaletteMira.yaml
  - python ruamelprettify.py PaletteMira.yaml PaletteMira.yaml
  # “-p” — prettify indented JSON:
  - yaml2json PaletteMira.yaml > PaletteMira.suricate-profile -p
  - 'ag -o "(?<=# )(.+?)(?= #)" PaletteMira.yaml > PaletteMiraPackages/active.txt'
  - 'ag -o "(?<=# )(.+?)(?= #)" PaletteMiraDeprecated.yaml > PaletteMiraPackages/deprecated.txt'

after_success:
  # https://www.computerhope.com/issues/ch000798.htm
  - rm -rf the_silver_searcher

deploy:
  provider: pages
  on:
    branch: SashaYAML
  keep-history: true
  skip-cleanup: true
  target-branch: SashaDevelop
  repo: Kristinita/SashaScrutinizer
  github-token: $GITHUB_TOKEN
  committer-from-gh: true
  project-name: PaletteMira
  verbose: true
